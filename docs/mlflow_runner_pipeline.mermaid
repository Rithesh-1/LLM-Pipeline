flowchart TD
    %% Entry Point
    Start([ğŸš€ Start MLflow Pipeline]) --> MLflow_Entry[ğŸ“Š run_mlflow.py<br/>MLflow Pipeline Runner]

    %% Configuration & Setup
    MLflow_Entry --> Parse_Args[âš™ï¸ Parse Arguments<br/>--pipeline, --config, etc.]
    Parse_Args --> Set_URI[ğŸ”— Set MLflow Tracking URI<br/>Local or Remote Server]
    Set_URI --> Load_Config[ğŸ“„ Load Pipeline Config<br/>YAML Configuration]
    Load_Config --> Start_Run[ğŸ¬ Start MLflow Run<br/>Create Experiment]

    %% Parameter Logging
    Start_Run --> Log_Params[ğŸ“ Log Parameters<br/>Config, Environment, Git Info]

    %% Pipeline Selection
    Log_Params --> Pipeline_Router{ğŸ¯ Select Pipeline}
    
    %% Pipeline Options
    Pipeline_Router -->|digital_data_etl| ETL_Pipeline[ğŸ“¥ Digital Data ETL<br/>Data Collection & Storage]
    Pipeline_Router -->|feature_engineering| Feature_Pipeline[ğŸ”§ Feature Engineering<br/>Data Processing & Embedding]
    Pipeline_Router -->|generate_instruct_datasets| Instruct_Pipeline[ğŸ“– Instruction Datasets<br/>Training Data Generation]
    Pipeline_Router -->|generate_preference_datasets| Preference_Pipeline[âš–ï¸ Preference Datasets<br/>Preference Data Generation]

    %% Pipeline Execution Details
    subgraph ETL_Execution ["ğŸ“¥ ETL Pipeline Execution"]
        ETL_Steps[ğŸ”„ Execute ETL Steps]
        ETL_Steps --> ETL_Crawling[ğŸ•·ï¸ Web Crawling]
        ETL_Steps --> ETL_Storage[ğŸ—„ï¸ MongoDB Storage]
        ETL_Steps --> ETL_Metrics[ğŸ“Š Log ETL Metrics]
    end

    subgraph Feature_Execution ["ğŸ”§ Feature Engineering Execution"]
        Feature_Steps[ğŸ”„ Execute Feature Steps]
        Feature_Steps --> Feature_Cleaning[ğŸ§¹ Data Cleaning]
        Feature_Steps --> Feature_Embedding[ğŸ”— Text Embedding]
        Feature_Steps --> Feature_Vector[ğŸ” Vector Storage]
        Feature_Steps --> Feature_Metrics[ğŸ“Š Log Feature Metrics]
    end

    subgraph Instruct_Execution ["ğŸ“– Instruction Dataset Execution"]
        Instruct_Steps[ğŸ”„ Execute Instruction Steps]
        Instruct_Steps --> Instruct_Generation[ğŸ¤– LLM Generation]
        Instruct_Steps --> Instruct_Validation[âœ… Data Validation]
        Instruct_Steps --> Instruct_HF[ğŸ¤— HuggingFace Upload]
        Instruct_Steps --> Instruct_Metrics[ğŸ“Š Log Dataset Metrics]
    end

    subgraph Preference_Execution ["âš–ï¸ Preference Dataset Execution"]
        Preference_Steps[ğŸ”„ Execute Preference Steps]
        Preference_Steps --> Preference_Generation[ğŸ¤– LLM Generation]
        Preference_Steps --> Preference_Ranking[ğŸ“Š Preference Ranking]
        Preference_Steps --> Preference_HF[ğŸ¤— HuggingFace Upload]
        Preference_Steps --> Preference_Metrics[ğŸ“Š Log Dataset Metrics]
    end

    %% Connect pipelines to execution
    ETL_Pipeline --> ETL_Execution
    Feature_Pipeline --> Feature_Execution
    Instruct_Pipeline --> Instruct_Execution
    Preference_Pipeline --> Preference_Execution

    %% MLflow Tracking
    MLflow_Server[ğŸ“Š MLflow Tracking Server<br/>Experiment Management]
    ETL_Metrics --> MLflow_Server
    Feature_Metrics --> MLflow_Server
    Instruct_Metrics --> MLflow_Server
    Preference_Metrics --> MLflow_Server

    %% Completion
    ETL_Execution --> Pipeline_Complete[âœ… Pipeline Complete]
    Feature_Execution --> Pipeline_Complete
    Instruct_Execution --> Pipeline_Complete
    Preference_Execution --> Pipeline_Complete

    Pipeline_Complete --> End_Run[ğŸ End MLflow Run<br/>Save Artifacts & Metrics]
    End_Run --> Success([âœ… Success])

    %% Styling
    classDef entryPoint fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef configStep fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef pipelineType fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef mlflowStep fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef executionStep fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class Start,Success entryPoint
    class Parse_Args,Set_URI,Load_Config,Start_Run,Log_Params configStep
    class ETL_Pipeline,Feature_Pipeline,Instruct_Pipeline,Preference_Pipeline pipelineType
    class MLflow_Server,End_Run mlflowStep
    class ETL_Steps,Feature_Steps,Instruct_Steps,Preference_Steps executionStep
